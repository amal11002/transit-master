<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>OneUI - Bootstrap 5 Admin Template &amp; UI Framework</title>

    <meta name="description" content="OneUI - Bootstrap 5 Admin Template &amp; UI Framework created by pixelcave">
    <meta name="author" content="pixelcave">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta -->
    <meta property="og:title" content="OneUI - Bootstrap 5 Admin Template &amp; UI Framework">
    <meta property="og:site_name" content="OneUI">
    <meta property="og:description" content="OneUI - Bootstrap 5 Admin Template &amp; UI Framework created by pixelcave">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <!-- Icons -->
    <!-- The following icons can be replaced with your own, they are used by desktop and mobile browsers -->
    <link rel="shortcut icon" href="assets/media/favicons/favicon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/media/favicons/favicon-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/media/favicons/apple-touch-icon-180x180.png">
    <!-- END Icons -->

    <!-- Stylesheets -->
    <!-- OneUI framework -->
    <link rel="stylesheet" id="css-main" href="assets/css/oneui.min.css">

    <!-- You can include a specific file from css/themes/ folder to alter the default color theme of the template. eg: -->
    <!-- <link rel="stylesheet" id="css-theme" href="assets/css/themes/amethyst.min.css"> -->
    <!-- END Stylesheets -->
  </head>

  <body>
    <!-- Page Container -->
    <!--
      Available classes for #page-container:

      GENERIC

        'remember-theme'                            Remembers active color theme and dark mode between pages using localStorage when set through
                                                    - Theme helper buttons [data-toggle="theme"],
                                                    - Layout helper buttons [data-toggle="layout" data-action="dark_mode_[on/off/toggle]"]
                                                    - ..and/or One.layout('dark_mode_[on/off/toggle]')

      SIDEBAR & SIDE OVERLAY

        'sidebar-r'                                 Right Sidebar and left Side Overlay (default is left Sidebar and right Side Overlay)
        'sidebar-mini'                              Mini hoverable Sidebar (screen width > 991px)
        'sidebar-o'                                 Visible Sidebar by default (screen width > 991px)
        'sidebar-o-xs'                              Visible Sidebar by default (screen width < 992px)
        'sidebar-dark'                              Dark themed sidebar

        'side-overlay-hover'                        Hoverable Side Overlay (screen width > 991px)
        'side-overlay-o'                            Visible Side Overlay by default

        'enable-page-overlay'                       Enables a visible clickable Page Overlay (closes Side Overlay on click) when Side Overlay opens

        'side-scroll'                               Enables custom scrolling on Sidebar and Side Overlay instead of native scrolling (screen width > 991px)

      HEADER

        ''                                          Static Header if no class is added
        'page-header-fixed'                         Fixed Header

      HEADER STYLE

        ''                                          Light themed Header
        'page-header-dark'                          Dark themed Header

      MAIN CONTENT LAYOUT

        ''                                          Full width Main Content if no class is added
        'main-content-boxed'                        Full width Main Content with a specific maximum width (screen width > 1200px)
        'main-content-narrow'                       Full width Main Content with a percentage width (screen width > 1200px)

      DARK MODE

        'sidebar-dark page-header-dark dark-mode'   Enable dark mode (light sidebar/header is not supported with dark mode)
    -->
    <div id="page-container" class="sidebar-o sidebar-dark enable-page-overlay side-scroll page-header-fixed main-content-narrow">
      <!-- Side Overlay-->
      <aside id="side-overlay">
        <!-- Side Header -->
        <div class="content-header border-bottom">
          <!-- User Avatar -->
          <a class="img-link me-1" href="javascript:void(0)">
            <img class="img-avatar img-avatar32" src="assets/media/avatars/avatar10.jpg" alt="">
          </a>
          <!-- END User Avatar -->

          

          

        <!-- Side Content -->
        <div class="content-side">
          <!-- Side Overlay Tabs -->
          <div class="block block-transparent pull-x pull-t">
            <ul class="nav nav-tabs nav-tabs-block nav-justified" role="tablist">
              
            </ul>
            <div class="block-content tab-content overflow-hidden">
              <!-- Overview Tab -->
              <div class="tab-pane pull-x fade fade-left show active" id="so-overview" role="tabpanel" aria-labelledby="so-overview-tab" tabindex="0">
                <!-- Activity -->
                <div class="block block-transparent">
                  <div class="block-header block-header-default">
                    
                  </div>
                  <div class="block-content">
                    <!-- Activity List -->
                    
                    <!-- END Activity List -->
                  </div>
                </div>
                <!-- END Activity -->

                <!-- Online Friends -->
                <div class="block block-transparent">
                  <div class="block-header block-header-default">
                   
                  </div>
                  <div class="block-content">
                    
                  </div>
                </div>
                <!-- END Online Friends -->

                <!-- Quick Settings -->
                <div class="block block-transparent mb-0">
                  <div class="block-header block-header-default">
                   
                  </div>
                  <div class="block-content">
                    
                  </div>
                </div>
                <!-- END Quick Settings -->
              </div>
              <!-- END Overview Tab -->

              <!-- Sales Tab -->
             
                  <!-- END Stats -->

                  <!-- Today -->
                  <div class="block-content block-content-full block-content-sm bg-body-light">
                    <div class="row">
                      <div class="col-6">
                        
                  </div>
                  <!-- END Today -->

                  <!-- Yesterday -->
                  <div class="block-content block-content-full block-content-sm bg-body-light">
                    
                    <!-- END More -->
                  </div>
                  <!-- END Yesterday -->
                </div>
              </div>
              <!-- END Sales Tab -->
            </div>
          </div>
          <!-- END Side Overlay Tabs -->
        </div>
        <!-- END Side Content -->
      </aside>
      <!-- END Side Overlay -->

      <!-- Sidebar -->
      <!--
          Sidebar Mini Mode - Display Helper classes

          Adding 'smini-hide' class to an element will make it invisible (opacity: 0) when the sidebar is in mini mode
          Adding 'smini-show' class to an element will make it visible (opacity: 1) when the sidebar is in mini mode
              If you would like to disable the transition animation, make sure to also add the 'no-transition' class to your element

          Adding 'smini-hidden' to an element will hide it when the sidebar is in mini mode
          Adding 'smini-visible' to an element will show it (display: inline-block) only when the sidebar is in mini mode
          Adding 'smini-visible-block' to an element will show it (display: block) only when the sidebar is in mini mode
      -->
      <nav id="sidebar" aria-label="Main Navigation">
        <!-- Side Header -->
        <div class="content-header">
          <!-- Logo -->
          <a class="fw-semibold text-dual" href="index.html">
            <span class="smini-visible">
              <i class="fa fa-circle-notch text-primary"></i>
            </span>
            <span class="smini-hide fs-5 tracking-wider">Transit Master</span>
          </a>
          <!-- END Logo -->

          <!-- Extra -->
          <div>
            <!-- Dark Mode -->
            <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
            <button type="button" class="btn btn-sm btn-alt-secondary" data-toggle="layout" data-action="dark_mode_toggle">
              <i class="far fa-moon"></i>
            </button>
            <!-- END Dark Mode -->

            <!-- Options -->
            <div class="dropdown d-inline-block ms-1">
              <button type="button" class="btn btn-sm btn-alt-secondary" id="sidebar-themes-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-brush"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-end fs-sm smini-hide border-0" aria-labelledby="sidebar-themes-dropdown">
                <!-- Color Themes -->
                <!-- Layout API, functionality initialized in Template._uiHandleTheme() -->
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="default" href="#">
                  <span>Default</span>
                  <i class="fa fa-circle text-default"></i>
                </a>
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="assets/css/themes/amethyst.min.css" href="#">
                  <span>Amethyst</span>
                  <i class="fa fa-circle text-amethyst"></i>
                </a>
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="assets/css/themes/city.min.css" href="#">
                  <span>City</span>
                  <i class="fa fa-circle text-city"></i>
                </a>
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="assets/css/themes/flat.min.css" href="#">
                  <span>Flat</span>
                  <i class="fa fa-circle text-flat"></i>
                </a>
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="assets/css/themes/modern.min.css" href="#">
                  <span>Modern</span>
                  <i class="fa fa-circle text-modern"></i>
                </a>
                <a class="dropdown-item d-flex align-items-center justify-content-between fw-medium" data-toggle="theme" data-theme="assets/css/themes/smooth.min.css" href="#">
                  <span>Smooth</span>
                  <i class="fa fa-circle text-smooth"></i>
                </a>
                <!-- END Color Themes -->

                <div class="dropdown-divider"></div>

                <!-- Sidebar Styles -->
                <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
                <a class="dropdown-item fw-medium" data-toggle="layout" data-action="sidebar_style_light" href="javascript:void(0)">
                  <span>Sidebar Light</span>
                </a>
                <a class="dropdown-item fw-medium" data-toggle="layout" data-action="sidebar_style_dark" href="javascript:void(0)">
                  <span>Sidebar Dark</span>
                </a>
                <!-- END Sidebar Styles -->

                <div class="dropdown-divider"></div>

                <!-- Header Styles -->
                <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
                <a class="dropdown-item fw-medium" data-toggle="layout" data-action="header_style_light" href="javascript:void(0)">
                  <span>Header Light</span>
                </a>
                <a class="dropdown-item fw-medium" data-toggle="layout" data-action="header_style_dark" href="javascript:void(0)">
                  <span>Header Dark</span>
                </a>
                <!-- END Header Styles -->
              </div>
            </div>
            <!-- END Options -->

            <!-- Close Sidebar, Visible only on mobile screens -->
            <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
            <a class="d-lg-none btn btn-sm btn-alt-secondary ms-1" data-toggle="layout" data-action="sidebar_close" href="javascript:void(0)">
              <i class="fa fa-fw fa-times"></i>
            </a>
            <!-- END Close Sidebar -->
          </div>
          <!-- END Extra -->
        </div>
        <!-- END Side Header -->

        <!-- Sidebar Scrolling -->
        <div class="js-sidebar-scroll">
          <!-- Side Navigation -->
          <div class="content-side">
            <ul class="nav-main">
              <li class="nav-main-item">
                <a class="nav-main-link" href="be_pages_dashboard.html">
                  <i class="nav-main-link-icon si si-speedometer"></i>
                  <span class="nav-main-link-name">Dashboard</span>
                </a>
              </li>
              
                
                 
          </div>
          <!-- END Side Navigation -->
        </div>
        <!-- END Sidebar Scrolling -->
      </nav>
      <!-- END Sidebar -->

      <!-- Header -->
      <header id="page-header">
        <!-- Header Content -->
        <div class="content-header">
          <!-- Left Section -->
          <div class="d-flex align-items-center">
            <!-- Toggle Sidebar -->
            <!-- Layout API, functionality initialized in Template._uiApiLayout()-->
            <button type="button" class="btn btn-sm btn-alt-secondary me-2 d-lg-none" data-toggle="layout" data-action="sidebar_toggle">
              <i class="fa fa-fw fa-bars"></i>
            </button>
            <!-- END Toggle Sidebar -->

            <!-- Open Search Section (visible on smaller screens) -->
            <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
            <button type="button" class="btn btn-sm btn-alt-secondary d-md-none" data-toggle="layout" data-action="header_search_on">
              <i class="fa fa-fw fa-search"></i>
            </button>
            <!-- END Open Search Section -->

            <!-- Search Form (visible on larger screens) -->
            <!-- <form class="d-none d-md-inline-block" action="be_pages_generic_search.html" method="POST">
              <div class="input-group input-group-sm">
                <input type="text" class="form-control form-control-alt" placeholder="Search.." id="page-header-search-input2" name="page-header-search-input2">
                <span class="input-group-text border-0">
                  <i class="fa fa-fw fa-search"></i>
                </span>
              </div>
            </form> -->
            <!-- END Search Form -->
          </div>
          <!-- END Left Section -->

         <!-- Right Section -->
         <div class="d-flex align-items-center">
            <!-- User Dropdown -->
            <div class="dropdown d-inline-block ms-2">
                <button type="button" class="btn btn-sm btn-alt-secondary d-flex align-items-center" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <img class="rounded-circle" src="assets/media/avatars/avatar10.jpg" alt="Header Avatar" style="width: 21px;">
                    <span class="d-none d-sm-inline-block ms-2" id="user-name"></span>
                    <i class="fa fa-fw fa-angle-down d-none d-sm-inline-block opacity-50 ms-1 mt-1"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-md dropdown-menu-end p-0 border-0" aria-labelledby="page-header-user-dropdown">
                    <div class="p-3 text-center bg-body-light border-bottom rounded-top">
                        <img class="img-avatar img-avatar48 img-avatar-thumb" src="assets/media/avatars/avatar10.jpg" alt="">
                        <p class="mt-2 mb-0 fw-medium" id="user-fullname"></p>
                        <p class="mt-2 mb-0 fw-medium" id="user-role"></p>
                        
                    </div>
                    <div class="p-2">
                        <a id="logout-link" class="dropdown-item d-flex align-items-center justify-content-between" href="#">
                            <span class="fs-sm fw-medium">Log Out</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
           

        <!-- Header Search -->
        <div id="page-header-search" class="overlay-header bg-body-extra-light">
          <div class="content-header">
            <form class="w-100" action="be_pages_generic_search.html" method="POST">
              <div class="input-group">
                <!-- Layout API, functionality initialized in Template._uiApiLayout() -->
                <button type="button" class="btn btn-alt-danger" data-toggle="layout" data-action="header_search_off">
                  <i class="fa fa-fw fa-times-circle"></i>
                </button>
                <input type="text" class="form-control" placeholder="Search or hit ESC.." id="page-header-search-input" name="page-header-search-input">
              </div>
            </form>
          </div>
        </div>
        <!-- END Header Search -->

        <!-- Header Loader -->
        <!-- Please check out the Loaders page under Components category to see examples of showing/hiding it -->
        <div id="page-header-loader" class="overlay-header bg-body-extra-light">
          <div class="content-header">
            <div class="w-100 text-center">
              <i class="fa fa-fw fa-circle-notch fa-spin"></i>
            </div>
          </div>
        </div>
        <!-- END Header Loader -->
      </header>
      <!-- END Header -->

      <!-- Main Container -->
      <main id="main-container">
        <!-- Hero -->
        <div class="bg-body-light">
          <div class="content content-full">
            <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center py-2">
              <div class="flex-grow-1">
                <h1 class="h3 fw-bold mb-1">
                  Modification
                </h1>
                <h2 class="fs-base lh-base fw-medium text-muted mb-0">
                  
                </h2>
              </div>
              <nav class="flex-shrink-0 mt-3 mt-sm-0 ms-sm-3" aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-alt">
                  <li class="breadcrumb-item">
                    <a class="link-fx" href="adashboard.html">Revenir Ã  la liste</a>
                  </li>
                  <li class="breadcrumb-item" aria-current="page">
                    
                  </li>
                </ol>
              </nav>
            </div>
          </div>
        </div>
        <!-- END Hero -->

        <div class="content">
            <div class="block block-rounded">
                <div class="block-header block-header-default">
                    <h3 class="block-title">Edit User</h3>
                </div>
                <div class="block-content block-content-full">
                    <form class="row g-3 align-items-center" id="edit-form">
                        <div class="col-12">
                            <label for="name">Name</label>
                            <input type="text" class="form-control form-control-alt" id="name" name="name" placeholder="Name">
                        </div>
                        <div class="col-12">
                            <label for="surname">Surname</label>
                            <input type="text" class="form-control form-control-alt" id="surname" name="surname" placeholder="Surname">
                        </div>
                        <div class="col-12">
                            <label for="email">Email</label>
                            <input type="email" class="form-control form-control-alt" id="email" name="email" placeholder="Email">
                        </div>
                        <div class="col-12">
                            <label for="phone">Phone Number</label>
                            <input type="text" class="form-control form-control-alt" id="phone" name="phone" placeholder="Phone Number">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Department</label>
                            <div class="space-x-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="department1" name="department" value="1">
                                    <label class="form-check-label" for="department1">Department Commercial</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="department2" name="department" value="2">
                                    <label class="form-check-label" for="department2">Department Operations</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="department3" name="department" value="3">
                                    <label class="form-check-label" for="department3">Department Facturations</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12" id="roles-container">
                            <!-- Roles will be populated based on department selection -->
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-dark">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
          // DOROPDOWN AND USER. CHECK
          document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('token');
    // Redirect to login page if token is not present
    if (!token) {
        window.location.href = 'aindex.html';
        return; // Stop further execution
    }
    fetch('http://localhost:8080/api/verify-token', {
        method: 'GET',
        headers: {
            'Authorization': 'Bearer ' + token,
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status && !data.isAdmin) {
            // Redirect to aindex.html if the user is not an admin
            window.location.href = 'aindex.html';
            return; // Stop further execution
        }
    const userId = localStorage.getItem('userId'); // Corrected 'id' here
    if (userId) {
        fetch(`http://localhost:8080/api/users/${userId}`)
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    const user = data.data;
                    document.getElementById('user-name').textContent = user.name;
                    document.getElementById('user-fullname').textContent = `${user.name} `;
                    document.getElementById('user-role').textContent = ` ${user.role.join(', ')}`;
                } else {
                    console.error('Failed to fetch user details:', data.message);
                }
            })
            .catch(error => console.error('Error:', error));
    }
});


          document.addEventListener('DOMContentLoaded', function() {
              const urlParams = new URLSearchParams(window.location.search);
              const userId = urlParams.get('id');
          
              if (!userId) {
                  console.error('User ID not found in URL.');
                  return;
              }
          
              // Fetch user details and populate the form
              fetch(`http://localhost:8080/api/users/${userId}`, {
                  headers: {
                      'Authorization': 'Bearer ' + localStorage.getItem('token')
                  }
              })
              .then(response => response.json())
              .then(data => {
                  if (data.status) {
                      const user = data.data;
                      document.getElementById('name').value = user.name;
                      document.getElementById('surname').value = user.surname;
                      document.getElementById('email').value = user.email;
                      document.getElementById('phone').value = user.phone_number;
          
                      // Set the department radio button
                      if (user.department_id) {
                          document.querySelector(`input[name="department"][value="${user.department_id}"]`).checked = true;
                      }
          
                      // Set the roles based on the department
                      updateRoles();
                      user.role_ids.forEach(roleId => {
                          const roleCheckbox = document.querySelector(`input[name="role"][value="${roleId}"]`);
                          if (roleCheckbox) {
                              roleCheckbox.checked = true;
                          }
                      });
                  } else {
                      console.error('Failed to fetch user details:', data.message);
                  }
              })
              .catch(error => console.error('Error:', error));
          
              function updateRoles() {
                  const department = document.querySelector('input[name="department"]:checked');
                  if (!department) {
                      return;
                  }
          
                  const departmentValue = department.value;
                  const rolesContainer = document.getElementById('roles-container');
                  let rolesHTML = '';
          
                  if (departmentValue === '1') {
                      rolesHTML = `
                          <label class="form-label">Role</label>
                          <div class="space-x-2">
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="1" id="role1" name="role">
                                  <label class="form-check-label" for="role1">Chef departement</label>
                              </div>
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="2" id="role2" name="role">
                                  <label class="form-check-label" for="role2">Commercial</label>
                              </div>
                          </div>
                      `;
                  } else if (departmentValue === '2') {
                      rolesHTML = `
                          <label class="form-label">Role</label>
                          <div class="space-x-2">
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="1" id="role1" name="role">
                                  <label class="form-check-label" for="role1">Chef departement</label>
                              </div>
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="3" id="role3" name="role">
                                  <label class="form-check-label" for="role3">Declarant</label>
                              </div>
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="4" id="role4" name="role">
                                  <label class="form-check-label" for="role4">Livreur</label>
                              </div>
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="6" id="role6" name="role">
                                  <label class="form-check-label" for="role6">Poursuivant</label>
                              </div>
                          </div>
                      `;
                  } else if (departmentValue === '3') {
                      rolesHTML = `
                          <label class="form-label">Role</label>
                          <div class="space-x-2">
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="1" id="role1" name="role">
                                  <label class="form-check-label" for="role1">Chef departement</label>
                              </div>
                              <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="checkbox" value="5" id="role5" name="role">
                                  <label class="form-check-label" for="role5">Comptable</label>
                              </div>
                          </div>
                      `;
                  }
          
                  rolesContainer.innerHTML = rolesHTML;
              }
          
              document.querySelectorAll('input[name="department"]').forEach(radio => {
                  radio.addEventListener('change', updateRoles);
              });
          
              document.getElementById('edit-form').addEventListener('submit', function(event) {
                  event.preventDefault();
                  const formData = new FormData(event.target);
          
                  const updatedUserData = {
                      name: formData.get('name'),
                      surname: formData.get('surname'),
                      email: formData.get('email'),
                      phone_number: formData.get('phone'),
                      department_id: formData.get('department'),
                      role_ids: Array.from(formData.getAll('role')).map(role => parseInt(role))
                  };
          
                  fetch(`http://localhost:8080/api/users/${userId}`, {
                      method: 'PUT',
                      headers: {
                          'Content-Type': 'application/json',
                          'Authorization': 'Bearer ' + localStorage.getItem('token')
                      },
                      body: JSON.stringify(updatedUserData)
                  })
                  .then(response => {
                      if (!response.ok) {
                          return response.json().then(err => { throw err; });
                      }
                      return response.json();
                  })
                  .then(result => {
                      if (result.status) {
                          // Update department
                          const updatedDepartmentData = {
                              departement_ids: [parseInt(updatedUserData.department_id)]
                          };
                          return fetch(`http://localhost:8080/api/users/${userId}/update-departement`, {
                              method: 'PUT',
                              headers: {
                                  'Content-Type': 'application/json',
                                  'Authorization': 'Bearer ' + localStorage.getItem('token')
                              },
                              body: JSON.stringify(updatedDepartmentData)
                          });
                      } else {
                          throw new Error('Failed to update user.');
                      }
                  })
                  .then(response => {
                      if (!response.ok) {
                          return response.json().then(err => { throw err; });
                      }
                      return response.json();
                  })
                  .then(deptResult => {
                      if (deptResult.status) {
                          // Update role
                          const updatedRoleData = {
                              role_ids: updatedUserData.role_ids
                          };
                          return fetch(`http://localhost:8080/api/users/${userId}/update-role`, {
                              method: 'PUT',
                              headers: {
                                  'Content-Type': 'application/json',
                                  'Authorization': 'Bearer ' + localStorage.getItem('token')
                              },
                              body: JSON.stringify(updatedRoleData)
                          });
                      } else {
                          throw new Error('Failed to update department.');
                      }
                  })
                  .then(response => {
                      if (!response.ok) {
                          return response.json().then(err => { throw err; });
                      }
                      return response.json();
                  })
                  .then(roleResult => {
                      if (roleResult.status) {
                          Swal.fire({
                              title: 'Success!',
                              text: 'User updated successfully.',
                              icon: 'success'
                          }).then(() => {
                              window.location.href = 'adashboard.html'; // Redirect back to the user list
                          });
                      } else {
                          throw new Error('Failed to update role.');
                      }
                  })
                  .catch(error => {
                      console.error('Error updating user:', error);
                      Swal.fire({
                          title: 'Error!',
                          text: 'Failed to update user. Please check the console for more details.',
                          icon: 'error'
                      });
                  });
              });
          });
        })
        .catch(error => console.error('Error:', error));

          </script>
</body>
</html>